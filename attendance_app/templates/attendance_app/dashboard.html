{% extends 'attendance_app/base.html' %}

{% block content %}
  
  <h2>Welcome, {{ employee.user.get_full_name|default:employee.user.username }}!</h2>
  <p>This is your attendance dashboard for <strong>{{ attendance.date }}</strong>.</p>
  
  <hr>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Today's Attendance</h5>
      
      {% if attendance.status == 'ABSENT' %}
        <p>Status: <span class="badge bg-danger">Absent</span></p>
        <p>You have not checked in yet.</p>
        
        <form method="post" action="{% url 'check_in' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-success">Check In Now</button>
        </form>

      {% elif attendance.status == 'PRESENT' and attendance.check_out is None %}
        <p>Status: <span class="badge bg-success">Present</span></p>
        <p>Checked in at: <strong>{{ attendance.check_in }}</strong></p>
        
        <form method="post" action="{% url 'check_out' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-warning">Check Out Now</button>
        </form>

      {% elif attendance.status == 'PRESENT' and attendance.check_out is not None %}
        <p>Status: <span class="badge bg-secondary">Day Completed</span></p>
        <p>Checked in at: <strong>{{ attendance.check_in }}</strong></p>
        <p>Checked out at: <strong>{{ attendance.check_out }}</strong></p>
        <p class="text-muted">You have completed your day.</p>
      
      {% else %}
        <p>Status: <span class="badge bg-info">{{ attendance.status }}</span></p>
        <p>No actions available.</p>
      {% endif %}

    </div>
  </div>
  <hr class="mt-5">
  <h3 class="mb-3">My Attendance History</h3>

  <div class="card">
    <div class="card-body">
      
      {% if attendance_history %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Status</th>
              <th scope="col">Check In</th>
              <th scope="col">Check Out</th>
            </tr>
          </thead>
          <tbody>
            {% for record in attendance_history %}
            <tr>
              <td>{{ record.date }}</td>
              <td>
                {% if record.status == 'PRESENT' %}
                  <span class="badge bg-success">Present</span>
                {% elif record.status == 'ABSENT' %}
                  <span class="badge bg-danger">Absent</span>
                {% else %}
                  <span class="badge bg-info">{{ record.status }}</span>
                {% endif %}
              </td>
              <td>{{ record.check_in|default:"---" }}</td>
              <td>{{ record.check_out|default:"---" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted">No attendance history found.</p>
      {% endif %}

    </div>
  </div>

{% endblock %}